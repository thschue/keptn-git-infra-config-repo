apiVersion: v2
actions:
  - name: "infrastructure"
    events:
      - name: "sh.keptn.event.platform-setup.triggered"
    tasks:
      - name: "crossplane"
        maxPollDuration: 1200
        files:
          - crossplane
          - scripts
        image: "ghcr.io/thschue/kubectl:latest"
        imagePullPolicy: "Always"
        cmd:
        - "ash"
        args:
        - "/keptn/scripts/run_crossplane.sh"
  - name: "set-infra-version"
    events:
      - name: "sh.keptn.event.infra-version.triggered"
    tasks:
      - name: "setVersion"
        files:
          - scripts
        image: "ghcr.io/thschue/kubectl:latest"
        imagePullPolicy: "Always"
        cmd:
          - "ash"
        args:
          - "/keptn/scripts/set_infra_version.sh"
        env:
          - name: INFRAVERSION
            value: "$.data.labels.version"
            valueFrom: event